$(document).ready(function(){$("#weatherTmpl").length&&$.when($.getScript("https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"),$.getScript("https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.bundle.min.js"),$.Deferred(function(e){$(e.resolve)})).done(function(){function e(){var e={};window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,a,o){e[a]=o});return e}function t(){ctx=document.getElementById("weatherMonthCanvas").getContext("2d"),blueGradient=ctx.createLinearGradient(0,0,0,170),orangeGradient=ctx.createLinearGradient(0,0,0,170),ctx.canvas.width=v,ctx.canvas.height=D,blueGradient.addColorStop(0,"#CEEAFF"),blueGradient.addColorStop(.5,"#CEEAFF"),blueGradient.addColorStop(1,"#81BCED"),orangeGradient.addColorStop(0,"#FFCF9F"),orangeGradient.addColorStop(.5,"#FFCF9F"),orangeGradient.addColorStop(1,"#FFBC7B"),_=!0}function a(e,t){var a;switch(mShort=moment.monthsShort("-"+F+"-",t),k){case"l":a=T[t];break;case"m":a=mShort;break;case"s":a=mShort.slice(0,2);break;case"xs":a=mShort.slice(0,1)}return a}function o(){var e=C.width();e<=350?(D=175,F="MMM",k="xs",E=50):e<=850?(D=175,F="MMM",k="s",E=25):e<=900?(F="MMM",k="m",E=25):(D=250,F="MMMM",k="l",E=20),weatherChart.options.scales.yAxes[0].ticks.stepSize=E,weatherChart.update(),C.css("height",D)}function r(e){var t=weatherChart.getElementAtEvent(e)[0];if(void 0!==t){var a=t._index,o=fullJsonMonthlyData[a];o.month=T[a],n(o)}}function n(e){P.html(B.html()),$("#monthlyDetailsWrapper").find("h3").html(lang.whatWill+" "+f+" "+lang.weatherBeLikeIn+" "+T[e.monthNum-1]+"?"),P.find(".tempHigh").html(e.high+S+" F / "+e.high_c+S+" C"),P.find(".tempLow").html(e.low+S+" F / "+e.low_c+S+" C"),void 0!==e.thunderDays?P.find(".thunderDays").html(e.thunderDays):P.find(".thunderDays").parent().hide(),void 0!==e.snowDays?P.find(".snowDays").html(e.snowDays):P.find(".snowDays").parent().hide(),void 0!==e.dryDays?P.find(".dryDays").html(e.dryDays):P.find(".dryDays").parent().hide(),void 0!==e.humidity?P.find(".humidity").html(e.humidity+"%"):P.find(".humidity").parent().hide(),void 0!==e.windSpeed?P.find(".windSpeed").html(e.windSpeed+" mph / "+e.windSpeed_kmph+" kmph"):P.find(".windSpeed").parent().hide(),void 0!==e.rainDays?P.find(".rainDays").html(e.rainDays):P.find(".rainDays").parent().hide()}function i(e,t){if(W=e,"undefined"!=typeof weatherData){t=void 0!==t&&t;weatherData[0].data=weatherData[0].temperature[e],weatherData[1].data=weatherData[1].temperature[e],t&&weatherChart.update()}}function l(){var e={type:"bar",data:{labels:T,datasets:weatherData},options:{onClick:r,onHover:r,tooltips:{enabled:!0,displayColors:!1,fontFamily:w,xAlign:"center",yAlign:"bottom",yPadding:10,xPadding:15,cornerRadius:25,borderWidth:1,borderColor:"#3394de",backgroundColor:"#FFF",caretPadding:-15,caretSize:8,titleFontSize:14,titleFontColor:"#999",titleFontStyle:"normal",bodyFontSize:15,bodyFontColor:"#FF8F00",bodyFontFamily:w,footerFontSize:12,footerFontColor:"#999",position:"nearest",mode:"index",callbacks:{title:function(e){return T[e[0].index]+" "+A},label:function(e,t){return t.datasets[e.datasetIndex]._tooltipLabel+": "+e.yLabel+degreeSymbolCanvas+" "+W},labelTextColor:function(e,t){return t.data.datasets[e.datasetIndex]._labelColor}}},layout:{padding:{top:0}},legend:{display:!0},responsive:!0,maintainAspectRatio:!1,onResize:o,title:{display:!0,fontSize:15,fontColor:"#999",text:[f+" "+lang.temperatureByMonth]},scales:{xAxes:[{categoryPercentage:1,barPercentage:.92,position:"bottom",display:!0,gridLines:{display:!0,color:y,tickMarkLength:18,lineWidth:1},ticks:{fontSize:13,fontColor:g,fontFamily:w,autoSkip:!1,padding:-12,labelOffset:M,maxRotation:0,callback:a}}],yAxes:[{display:!0,gridLines:{display:!0,color:y,tickMarkLength:5,zeroLineColor:y},ticks:{fontSize:13,fontColor:g,fontFamily:w,padding:8,stepSize:E,maxTicksLimit:3,beginAtZero:!0,callback:function(e,t,a){return e+degreeSymbolCanvas+" "+W}}}]}}};"undefined"!=typeof weatherChart&&weatherChart.destroy(),weatherChart=new Chart(ctx,e),setTimeout(o,250)}var s=window.navigator.userLanguage||window.navigator.language,d=moment().format("YYYY-MM-DD"),c=$("#weatherTmpl"),h=$.trim(c.data("locationid")),m=$.trim(c.data("weathertype")),f=$.trim(c.data("city")),u=$.trim(c.data("fromdate")),p=$.trim(c.data("todate")),y="rgb(192, 225, 249)",g="rgb(110, 120, 139)",w="helvetica, arial, verdana, sans-serif",C=$("#canvasWrapper"),b=$("body"),v=b.width(),D=v<=270?175:250,F="MMMM",M=0,S="&deg;",k="l",x=$.trim(c.data("aky")),L=e().showdebug,_=!1,T=moment.months(),A=moment().year(),E=20,P=$("#monthlyDetails"),B=$("#monthlyDetails-Tmpl"),j=$.trim(c.data("currentmonthnum")),H=j>0?j-1:moment().month(),W=$.trim(c.data("degreemeasunit")).toUpperCase(),z=$.trim(c.data("imgpath"));"undefined"!=typeof rateCheckerLoadParams&&rateCheckerLoadParams.ajaxAccessKey&&(x=rateCheckerLoadParams.ajaxAccessKey),moment.locale(s.slice(0,2));var G={forecast:{el:$("#forecast"),dateDisplay:function(e){var t=moment(e).diff(d,"days");switch(t){case 0:formattedDt="Today";break;case 1:formattedDt="Tomorrow";break;default:formattedDt=moment(e).format("ddd M/DD")}return formattedDt},buildHtml:function(e,t){t=void 0!==t&&t;var a="";$.each(e,function(e,o){var r="F"===W?o.high:o.high_c,n="F"===W?o.low:o.low_c,i='<span class="fcHigh">'+r+S+'</span><br><span class="fcLow">'+n+S+'</span><span class="fcTempMeas">'+W+"</span>";t?$("ul.fcDay:nth-child("+(e+1)+") .fcTemp").html(i):a+='                                 <ul class="fcDay">                                     <li class="fcDate">'+G.forecast.dateDisplay(o.date)+'</li>                                     <li class="fcTemp">'+i+'</li>                                     <li class="fcImg"><img src="'+z+o.weatherCode+'.png"></li>                                        <li class="fcRain">'+o.rainChancePerc+"% "+lang.chanceOfRain+'</li>                                        <li class="fcDesc">'+lang["wc"+o.weatherCode]+"</li>                                    </ul>                                                                    "}),t||this.el.html(a)}}},O={Show:function(e){L&&c.html("<h4>Chart Error:</h4>"+O.FormatError(e)).css("fontSize","15px").show()},FormatError:function(e){var t,a,o="",r=!0;try{t=$.parseJSON(e.responseText)}catch(e){r=!1}return r&&null!==t?(a=t.errors,$.each(a,function(e,t){$.each(t,function(e,t){if("message"===e.toLowerCase()&&""!==t)return o="<li>A Server Error Has Occurred</li>",!1;""!=t&&(o+="<li>"+t+"</li>")})})):o="<li>A Server Error Has Occurred</li>",o=""!=o?o:"<li>"+t.text+"</li>","<ul>"+o+"</ul>"}},I={locationId:function(){return""===h?(L&&console.info("HTML attribute 'data-locationid' is empty. Process aborted."),!1):!!/^([0-9]){4,8}$/.test(h)||(L&&console.info("HTML attribute 'data-locationid' must have a numeric value of at least 4 digits. Process aborted."),!1)},weathertype:function(){return m=m.toLowerCase(),""===m||"all"===m||"monthly"===m||"daily"===m||(L&&console.info("HTML attribute 'data-weathertype' must be an empty string (defaults to 'all') or one of the following: 'all', 'daily' or 'monthly'. Process aborted."),!1)},degreeMeasUnit:function(){return""!==W&&("F"===W||"C"===W)||(L&&console.info("HTML attribute 'data-degreeMeasUnit' must be one of the following: 'F' or 'C'. Process aborted."),!1)},currentMonthNum:function(){return!(H<1||H>12)||(L&&console.info("HTML attribute 'data-currentMonthNum' must have a numeric value between 1 and 12. Process aborted."),!1)},queryParams:function(){return this.locationId()&&this.weathertype()&&this.degreeMeasUnit()&&this.currentMonthNum()}};if(I.queryParams()){var R="/com/hotelplanner/controller/WeatherController.cfc?method=getweather",N={location_id:h,weathertype:m,fromDate:u,toDate:p,aky:x};$.ajax({url:R,data:N,cache:!0}).done(function(e){if(!$.isEmptyObject(e.data))if(e.success){if(c.show(),!$.isEmptyObject(e.data.forecast)){_forecastData=e.data.forecast;var a=_forecastData.length>1?_forecastData.length+" "+lang.daysOfWeatherFor:lang.dayOfWeatherFor;$("#forecastWrapper h3").html(lang.next+" "+a+" "+f),$("#forecastWrapper").show(),$("#degreeType").show(),G.forecast.buildHtml(_forecastData)}$.isEmptyObject(e.data.monthlyAvg)||($("#chartWrapper").show(),$("#degreeType").show(),_||t(),fullJsonMonthlyData=e.data.monthlyAvg,n(fullJsonMonthlyData[H]),weatherData=J(e.data.monthlyAvg),i(W),l(),$("div#weatherWrapper").show())}else O.Show(e)}).fail(O.Show)}$("#satAsF").on("click",function(e){e.preventDefault(),i("F",!0),$("#degreeType a").removeClass("active"),$(this).addClass("active"),"undefined"!=typeof _forecastData&&G.forecast.buildHtml(_forecastData,!0)}),$("#satAsC").on("click",function(e){e.preventDefault(),i("C",!0),$("#degreeType a").removeClass("active"),$(this).addClass("active"),"undefined"!=typeof _forecastData&&G.forecast.buildHtml(_forecastData,!0)});var J=function(e){var t=[],a=[],o=[],r=[],n=[],i=["#81BCED","#FFBC7B"],l=[blueGradient,orangeGradient];return $.each(e,function(e,t){a.push(t.low),o.push(t.high),r.push(t.low_c),n.push(t.high_c)}),t.push({label:lang.highs,_tooltipLabel:lang.high,_labelColor:i[1],backgroundColor:l[1],hoverBackgroundColor:l[1],fill:!1,hoverBorderWidth:1,hoverBorderColor:"#3394DE",temperature:{F:o,C:n}}),t.push({label:lang.lows,_tooltipLabel:lang.low,_labelColor:i[0],backgroundColor:l[0],hoverBackgroundColor:l[0],fill:!1,hoverBorderWidth:1,hoverBorderColor:"#3394DE",temperature:{F:a,C:r}}),t};C.on("resize",o)})});